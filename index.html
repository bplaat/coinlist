<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cryptocurrency coins list</title>
    <script src="/vue.min.js"></script>
    <style>
*{box-sizing:border-box}
body,table,select{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif;font-size:16px;line-height:1.5}
body{margin:0;color:#111;background-color:#fff;overflow-y:scroll}
a{color:inherit;text-decoration:none;font-weight:bold}a:hover,a:focus{text-decoration:underline}
#app{padding:.5em 1em;margin:0 auto;width:90em}[v-cloak]{display:none}

.columns{display:flex}.column{flex:1}
.options{display:flex;justify-content:flex-end;align-items:center}
.select{padding:.5em 1em}

.table{width:100%;border-collapse:collapse;table-layout:fixed}
.table>thead>tr{border-bottom:2px solid #ccc}
.table>tbody>tr{border-bottom:1px solid #ddd}
.table td,.table th{padding:.5em 1em;text-align:left}
.positive{color:green}.negative{color:red}
.coin{height:4em}
.coin-icon{width:32px;height:32px;margin-right:16px;vertical-align:middle}
.coin-symbol{color:#777}
    </style>
</head>
<body>
    <div id="app">
        <div class="columns">
            <div class="column">
                <h1><a href="/">Cryptocurrency coins list</a></h1>
            </div>

            <div class="column options">
                <select class="select" v-model="baseCurrency">
                    <option value="USD">US Dollar (USD)</option>
                    <option value="EUR">Euro (EUR)</option>
                    <option value="BTC">Bitcoin (BTC)</option>
                </select>
            </div>
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th style="width: 4%">#</th>
                    <th style="width: 20%">Name</th>
                    <th style="width: 7%">Price</th>
                    <th style="width: 6%">1H</th>
                    <th style="width: 6%">1D</th>
                    <th style="width: 6%">1W</th>
                    <th style="width: 14%">Market Cap</th>
                    <th style="width: 14%">Volume (24h)</th>
                    <th style="width: 16%">Circulating Supply</th>
                    <th style="width: 7%">ATH</th>
                </tr>
            </thead>
            <tbody v-cloak v-if="coins.length">
                <tr class="coin" v-for="coin in coins">
                    <td>{{ coin.market_cap_rank }}</td>
                    <td>
                        <img class="coin-icon" :src="coin.image" :alt="coin.name + ' icon'" loading="lazy">
                        {{ coin.name }} <span class="coin-symbol">{{ coin.symbol.toUpperCase() }}</span>
                    </td>
                    <td>{{ coin.current_price | currency }}</td>
                    <td :class="getColor(coin.price_change_percentage_1h_in_currency)">{{ coin.price_change_percentage_1h_in_currency | percent }}</td>
                    <td :class="getColor(coin.price_change_percentage_24h_in_currency)">{{ coin.price_change_percentage_24h_in_currency | percent }}</td>
                    <td :class="getColor(coin.price_change_percentage_7d_in_currency)">{{ coin.price_change_percentage_7d_in_currency | percent }}</td>
                    <td>{{ coin.market_cap | currency }}</td>
                    <td>{{ coin.total_volume | currency }}</td>
                    <td v-if="coin.total_supply != null && coin.circulating_supply != coin.total_supply">
                        {{ coin.circulating_supply | number }} {{ coin.symbol.toUpperCase() }}<br>
                        {{ coin.total_supply | number }} {{ coin.symbol.toUpperCase() }}
                    </td>
                    <td v-else>
                        {{ coin.circulating_supply | number }} {{ coin.symbol.toUpperCase() }}
                    </td>
                    <td>{{ coin.ath | currency }}</td>
                </tr>
            </tbody>
            <tbody v-else>
                <tr>
                    <td colspan="10">Loading...</td>
                </tr>
            </tbody>
        </table>
        <p>Made by <a href="https://bastiaan.ml/" target="_blank">Bastiaan van der Plaat</a> for you to get fast cryptocurrency coins information</p>
    </div>
    <script>
var app = new Vue({
    el: '#app',

    data: {
        baseCurrency: 'USD',
        fetching: false,
        coins: []
    },

    filters: {
        number: function (value) {
            value = parseFloat(value);
            return value.toLocaleString('en-US', { minimumFractionDigits: value < 10 ? 4 : 2 });
        },

        currency: function (value) {
            value = parseFloat(value);
            return value.toLocaleString('en-US', { minimumFractionDigits: value < 10 ? 4 : 2, style: 'currency', currency: app.baseCurrency }).replace(/BTC\s/, '\u20bf');
        },

        percent: function (value) {
            value = parseFloat(value);
            return (value > 0 ? '+' : '') + value.toFixed(2) + '%';
        }
    },

    created: function () {
        if (localStorage.baseCurrency != null) {
            this.baseCurrency = localStorage.baseCurrency;
        }

        setInterval(this.fetchData, 10 * 1000);
        this.fetchData();
    },

    watch: {
        baseCurrency(newBaseCurrency) {
            localStorage.baseCurrency = newBaseCurrency;
            this.fetchData();
        }
    },

    methods: {
        getColor: function (value) {
            return parseFloat(value) > 0 ? 'positive' : 'negative';
        },

        fetchData: function () {
            if (!this.fetching) {
                this.fetching = true;
                var xhr = new XMLHttpRequest();
                xhr.onload = () => {
                    this.coins = JSON.parse(xhr.responseText);
                    this.fetching = false;
                };
                xhr.open('GET', 'https://api.coingecko.com/api/v3/coins/markets?vs_currency=' + this.baseCurrency + '&price_change_percentage=1h,24h,7d');
                xhr.send();
            }
        }
    }
});
    </script>
</body>
</html>
