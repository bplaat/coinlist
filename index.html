<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Cryptocurrency List</title>
        <script src="/vue.min.js"></script>
        <style>
            body,table{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif;font-size:16px;line-height:1.5}
            body{margin:0;color:#222;background-color:#fff}
            a{color:inherit;text-decoration:none;font-weight:bold}a:hover,a:focus{text-decoration:underline}
            #app{padding:.5em 1em;margin:0 auto;max-width:68em}
            table{width:100%;border-collapse:collapse}
            thead>tr{border-bottom:2px solid #ccc}
            tbody>tr{border-bottom:1px solid #ddd}
            td,th{padding:.5em 1em;text-align:left}
            .positive{color:green}.negative{color:red}
            [v-cloak]{display:none}
        </style>
    </head>
    <body>
        <div id="app">
            <h1><a href="/">Cryptocurrency List</a></h1>
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Name</th>
                        <th>Price (EUR)</th>
                        <th>Available Supply</th>
                        <th>1H</th>
                        <th>1D</th>
                        <th>1W</th>
                        <th>Market Cap (EUR)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-cloak v-if="coins.length > 0" v-for="coin in coins">
                        <td>{{ coin.rank }}</td>
                        <td>{{ coin.name }}</td>
                        <td>{{ coin.price_eur | currency }}</td>
                        <td>{{ coin.available_supply | number }} {{ coin.symbol }}</td>
                        <td :class="getColor(coin.percent_change_1h)">{{ coin.percent_change_1h | percent }}</td>
                        <td :class="getColor(coin.percent_change_24h)">{{ coin.percent_change_24h | percent }}</td>
                        <td :class="getColor(coin.percent_change_7d)">{{ coin.percent_change_7d | percent }}</td>
                        <td>{{ coin.market_cap_eur | currency }}</td>
                    </tr>
                    <tr v-else>
                        <td colspan="8">Loading...</td>
                    </tr>
                </tbody>
            </table>
            <p>Made by <a href="https://bastiaan.plaatsoft.nl/" target="_blank">Bastiaan van der Plaat</a> for you to get fast cryptocurrency information.</p>
        </div>
        <script>
            var app = new Vue({
                el: '#app',
                data: {
                    coins: []
                },
                created: function () {
                    this.fetchData();
                },
                filters: {
                    number: function (value) {
                        return Number(value).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                    },
                    currency: function (value) {
                        return '\u20AC' + Number(value).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                    },
                    percent: function (value) {
                        return (value > 0 ? '+' : '') + value + '%';
                    }
                },
                methods: {
                    getColor: function (number) {
                        return number > 0 ? 'positive' : 'negative';
                    },
                    fetchData: function () {
                        var xhr = new XMLHttpRequest(), self = this;
                        xhr.onload = function () {
                            setTimeout(self.fetchData, 60 * 1000);
                            self.coins = JSON.parse(xhr.responseText);
                        }
                        xhr.open('GET', 'https://api.coinmarketcap.com/v1/ticker/?convert=EUR&limit=100');
                        xhr.send();
                    }
                }
            })
        </script>
    </body>
</html>